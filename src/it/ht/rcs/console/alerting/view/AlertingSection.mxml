<?xml version="1.0" encoding="utf-8"?>
<s:Panel xmlns:fx="http://ns.adobe.com/mxml/2009" 
         xmlns:s="library://ns.adobe.com/flex/spark" 
         xmlns:mx="library://ns.adobe.com/flex/mx"
         title="ALERTING" width="100%" height="100%" 
         xmlns:alerting="it.ht.rcs.console.monitor.*"
         addedToStage="added()"
         removedFromStage="removed()"
         creationComplete="init()">

  <fx:Script>
    <![CDATA[
      import it.ht.rcs.console.alert.controller.AlertManager;
      
      import mx.collections.ListCollectionView;
      import mx.collections.Sort;
      import mx.collections.SortField;
      
      [Bindable]
      private var _alert_view:ListCollectionView;
      
      private function init():void
      {
        /* default sorting: status */
        var sort:Sort = new Sort();
        sort.fields = [new SortField('_id', true, true, true)];
        
        _alert_view = AlertManager.instance.getView(sort);
      }
      
      private function added():void
      {
        /* start the auto refresh when the section is open */
        AlertManager.instance.start();
      }
      
      private function removed():void
      {
        /* stop the auto refresh when going away */
        AlertManager.instance.stop();
      }
    ]]>
  </fx:Script>
  
  <fx:Metadata>
    [ResourceBundle("localized_main")] 
  </fx:Metadata>
  
  <s:VGroup width="100%" height="100%">
    
    <!-- ALERT QUERIES -->
    <s:SkinnableContainer width="100%" height="100%">
      
      <!-- button bar (transparent container) -->  
      <s:BorderContainer borderVisible="false" top="5" left="5" right="5" height="20" backgroundAlpha="0.0">
        <s:Button x="0" y="0" label="N" width="30" height="20" toolTip="{resourceManager.getString('localized_main', 'NEW')}" skinClass="it.ht.rcs.console.skins.SortButton"/>
        <s:Button x="40" y="0" label="E" width="30" height="20" toolTip="{resourceManager.getString('localized_main', 'EDIT')}" skinClass="it.ht.rcs.console.skins.SortNameButton"/>
        <s:Button x="80" y="0" label="D" width="30" height="20" visible="{console.currentSession.user.is_admin()}" toolTip="{resourceManager.getString('localized_main', 'DELETE')}" skinClass="it.ht.rcs.console.skins.ContactButton"/>
      </s:BorderContainer>
      
      <!-- alert queries -->
      <s:DataGrid left="5" right="5" top="30" height="100%" dataProvider="{_alert_view}">
        <s:columns>
          <s:ArrayList>
            <s:GridColumn dataField="num" headerText="N" width="30"/>
            <s:GridColumn dataField="enabled" headerText="En" width="30">
              <s:itemRenderer>
                <fx:Component>
                  <s:GridItemRenderer>
                    <s:SkinnableContainer>
                      <s:CheckBox selected="@{data.enabled}" top="4" right="5" left="8"/>                                          
                    </s:SkinnableContainer>
                  </s:GridItemRenderer>
                </fx:Component>
              </s:itemRenderer>
            </s:GridColumn>
            <s:GridColumn dataField="type" headerText="Type" width="50"/>
            <s:GridColumn dataField="priority" headerText="Tag" width="35"/>
            <s:GridColumn dataField="path" headerText="Operation"></s:GridColumn>
            <s:GridColumn dataField="path" headerText="Target"></s:GridColumn>
            <s:GridColumn dataField="path" headerText="Backdoor"></s:GridColumn>
            <s:GridColumn dataField="evidence" headerText="Evidence" width="80"/>
            <s:GridColumn dataField="keywords" headerText="Keywords"></s:GridColumn>
          </s:ArrayList>
        </s:columns>
      </s:DataGrid>
      
    </s:SkinnableContainer>

    <!-- ALERT LOGS -->
    <s:SkinnableContainer width="100%" height="100%">
      
      <!-- button bar (transparent container) -->  
      <s:BorderContainer borderVisible="false" top="5" left="5" right="5" height="20" backgroundAlpha="0.0">
        <s:Button x="0" y="0" label="N" width="30" height="20" toolTip="{resourceManager.getString('localized_main', 'DELETE')}" skinClass="it.ht.rcs.console.skins.SortButton"/>
        <s:Button x="40" y="0" label="E" width="30" height="20" toolTip="{resourceManager.getString('localized_main', 'DELETE')}" skinClass="it.ht.rcs.console.skins.SortNameButton"/>
      </s:BorderContainer>
      
      <s:DataGrid left="5" right="5" top="30" bottom="5" requestedRowCount="4">
        <s:columns>
          <s:ArrayList>
            <s:GridColumn dataField="dataField1" headerText="Time" width="130"/>
            <s:GridColumn dataField="dataField2" headerText="Backdoor" width="250"/>
            <s:GridColumn dataField="dataField3" headerText="Evidence"></s:GridColumn>
          </s:ArrayList>
        </s:columns>
        <s:typicalItem>
          <fx:Object dataField1="Sample Data" dataField2="Sample Data" dataField3="Sample Data"></fx:Object>
        </s:typicalItem>
        <s:ArrayList>
          <fx:Object dataField1="2011-06-02 15:30:00" dataField2="data1" dataField3="data1"></fx:Object>
          <fx:Object dataField1="2011-06-02 15:30:00" dataField2="data2" dataField3="data2"></fx:Object>
          <fx:Object dataField1="2011-06-02 15:30:00" dataField2="data3" dataField3="data3"></fx:Object>
          <fx:Object dataField1="2011-06-02 15:30:00" dataField2="data4" dataField3="data4"></fx:Object>
        </s:ArrayList>
      </s:DataGrid>
      
    </s:SkinnableContainer>
  </s:VGroup>
</s:Panel>
