<?xml version="1.0" encoding="utf-8"?>
<s:Panel xmlns:fx="http://ns.adobe.com/mxml/2009"
         xmlns:s="library://ns.adobe.com/flex/spark"
         xmlns:mx="library://ns.adobe.com/flex/mx"
         xmlns:db="it.ht.rcs.services.db.*"
         width="1052" height="506" title="AUDIT">
  <fx:Script>
    <![CDATA[
      import com.adobe.serialization.json.JSON;
      
      import mx.controls.Alert;
      import mx.events.FlexEvent;
      import mx.rpc.events.ResultEvent;
      
      [Bindable]
      private var filterString:String = '';
      
      protected function adg1_creationCompleteHandler(event:FlexEvent):void
      {
        var filter:Object = {}
        if (filterString != '')
          filter['action'] = filterString;
        console.currentDB.audit_index(filter, onResult);
        //audit_indexResult3.token = dB.audit_index(JSON.encode(filter));
      }
      
      private function onResult(e:ResultEvent):void
      {
        adg1.dataProvider = e.result;
      }
      
      protected function onFilterChange(event:Event):void
      {
        var filter:Object = {}
        if (filterString != '')
          filter['action'] = filterString;
        console.currentDB.audit_index(filter, onResult);
        //audit_indexResult3.token = dB.audit_index(JSON.encode(filter));
      }
    ]]>
  </fx:Script>
  <fx:Declarations>
    <!-- <db:DB id="dB" fault="Alert.show(event.fault.faultString + '\n' + event.fault.faultDetail)"
           showBusyCursor="true" baseURL="{console.currentSession.server}"/>
    <s:CallResponder id="audit_indexResult3"/> -->
  </fx:Declarations>
  <mx:AdvancedDataGrid id="adg1" left="0" right="0" bottom="274" height="160"
                       creationComplete="adg1_creationCompleteHandler(event)"
                       designViewDataType="flat">
    <mx:columns>
      <mx:AdvancedDataGridColumn dataField="time" headerText="time"/>
      <mx:AdvancedDataGridColumn dataField="desc" headerText="desc"/>
      <mx:AdvancedDataGridColumn dataField="_id" headerText="_id"/>
      <mx:AdvancedDataGridColumn dataField="action" headerText="action"/>
      <mx:AdvancedDataGridColumn dataField="actor" headerText="actor"/>
      <mx:AdvancedDataGridColumn dataField="user" headerText="user"/>
    </mx:columns>
  </mx:AdvancedDataGrid>
  <s:TextInput x="5" y="10" text="@{filterString}" />
  <s:Button x="141" y="10" label="Filter" click="onFilterChange(event)"/>
</s:Panel>