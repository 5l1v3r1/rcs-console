<?xml version="1.0" encoding="utf-8"?>
<utils:TitleWindowSaveCancel xmlns:fx="http://ns.adobe.com/mxml/2009"
                             xmlns:s="library://ns.adobe.com/flex/spark"
                             xmlns:mx="library://ns.adobe.com/flex/mx"
                             xmlns:utils="it.ht.rcs.console.utils.*"
                             creationComplete="init()" save="save()" title="{R.get('QUICK_AGENT')}">
  
  <fx:Script>
    <![CDATA[
      import it.ht.rcs.console.ObjectUtils;
      import it.ht.rcs.console.agent.controller.AgentManager;
      import it.ht.rcs.console.agent.model.Agent;
      import it.ht.rcs.console.events.SectionEvent;
      import it.ht.rcs.console.operation.controller.OperationManager;
      import it.ht.rcs.console.operation.model.Operation;
      import it.ht.rcs.console.search.model.SearchItem;
      import it.ht.rcs.console.target.controller.TargetManager;
      import it.ht.rcs.console.target.model.Target;
      
      import locale.R;
      
      import mx.core.FlexGlobals;
      
      private function init():void
      {
        agentName.setFocus();
        saveButton.label = "OK";
      }
      
      private function save():void
      {
        var o:Operation = new Operation(Operation.defaultOperation());
        o.name = agentName.text;
        OperationManager.instance.addOperation(ObjectUtils.toHash(o), function(o1:Operation):void
        {
          var t:Target = new Target(Target.defaultTarget());
          t.name = agentName.text;
          TargetManager.instance.addTarget(ObjectUtils.toHash(t), o1, function(t1:Target):void
          {
            var a:Agent = new Agent(Agent.defaultAgent());
            a._kind = 'factory';
            a.name = agentName.text;
            AgentManager.instance.addFactory(ObjectUtils.toHash(a), o1, t1, function(a1:Agent):void
            {
              var sectionEvent:SectionEvent = new SectionEvent(SectionEvent.CHANGE_SECTION);
              sectionEvent.section = 'Operations';
              sectionEvent.item = new SearchItem(a1);
              FlexGlobals.topLevelApplication.dispatchEvent(sectionEvent);
              close();
            });
          });
        });
      }
    ]]>
  </fx:Script>
  
  <s:VGroup horizontalAlign="center" paddingLeft="20" paddingRight="20" paddingTop="20">

    <s:Label text="{R.get('QUICK_AGENT_HELP')}" lineBreak="explicit" textAlign="center"/>
    
    <s:Form defaultButton="{saveButton}">
      <s:FormItem>
        <s:TextInput id="agentName" width="200"/>
      </s:FormItem>
    </s:Form>
    
  </s:VGroup>
  
</utils:TitleWindowSaveCancel>