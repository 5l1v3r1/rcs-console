<?xml version="1.0" encoding="utf-8"?>
<main:Section xmlns:fx="http://ns.adobe.com/mxml/2009"
              xmlns:s="library://ns.adobe.com/flex/spark"
              xmlns:mx="library://ns.adobe.com/flex/mx"
              xmlns:main="it.ht.rcs.console.main.*"
              xmlns:dashboard="it.ht.rcs.console.dashboard.view.*"
              xmlns:search="it.ht.rcs.console.operations.search.*"
              xmlns:items="it.ht.rcs.console.utils.items.*"
              addedToStage="onAddedToStage()" creationComplete="init()"
              removedFromStage="onRemovedFromStage()">

  <fx:Script>
    <![CDATA[
      import it.ht.rcs.console.dashboard.controller.DashboardController;
      import it.ht.rcs.console.search.model.SearchItem;
      
      import mx.collections.ListCollectionView;
      
      [Bindable]
      private var view:ListCollectionView;
      
      private function init():void
      {
        view = DashboardController.instance.getView();
        
        DashboardController.instance.user = Console.currentSession.user;
        DashboardController.instance.refresh();
      }
      
      private function onAddedToStage():void
      {
        DashboardController.instance.startAutoRefresh();
      }
      
      private function onRemovedFromStage():void
      {
        DashboardController.instance.stopAutoRefresh();
      }
      
//      private function onDashboardDataLoaded(event:DataLoadedEvent):void
//      {
//        if (_dashboard_items == null) {
//          var sort:ISort = new Sort();
//          _dashboard_items = DashboardController.instance.getView();
//          sort.compareFunction = compareSyncTime;
//          _dashboard_items.sort = sort;
//          _dashboard_items.refresh();
//        }
//      }
      
      private function compareSyncTime(a:SearchItem, b:SearchItem, fields:Array=null):int {
        if (a.stat.last_sync < b.stat.last_sync)
          return 1;
        else if (a.stat.last_sync > b.stat.last_sync)
          return -1;
        else
          return 0
      };
      
//      private function sort_by_time():void
//      {
//        var sort:Sort = new Sort();
//        sort.compareFunction = compareSyncTime;
//        _dashboard_items.sort = sort;
//        _dashboard_items.refresh();
//      }
//      
//      private function sort_by_name():void
//      {
//        _dashboard_items.sort = new Sort();
//        _dashboard_items.refresh();
//      }
    ]]>
  </fx:Script>
  
  <main:layout>
    <s:VerticalLayout paddingBottom="5" paddingLeft="5" paddingRight="5" paddingTop="5"/>
  </main:layout>
  
  <dashboard:DashboardActionBar/>
  
  <s:List width="100%" height="100%" borderVisible="false" dataProvider="{view}"
          itemRenderer="it.ht.rcs.console.dashboard.view.renderer.DashboardRenderer"/>
  
</main:Section>