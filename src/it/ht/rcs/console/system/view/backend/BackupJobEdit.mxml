<?xml version="1.0" encoding="utf-8"?>
<utils:TitleWindowSaveClose xmlns:fx="http://ns.adobe.com/mxml/2009" 
                             xmlns:s="library://ns.adobe.com/flex/spark" 
                             xmlns:mx="library://ns.adobe.com/flex/mx" 
                             xmlns:utils="it.ht.rcs.console.utils.*" width="400" height="340"
                             skinClass="it.ht.rcs.console.skins.TitleWindowSaveCloseSkin"
                             save="saveMe()"
                             title="{resourceManager.getString('localized_main', 'EDIT_BACKUP').toUpperCase()}" 
                             xmlns:view="it.ht.rcs.console.system.view.*" 
                             xmlns:items="it.ht.rcs.console.utils.items.*">

  <fx:Script>
    <![CDATA[
      import it.ht.rcs.console.backup.model.BackupJob;
      
      import locale.R;
      
      import mx.collections.ArrayCollection;
      import mx.managers.PopUpManager;
      
      [Bindable]
      private var _job:BackupJob;
      [Bindable]
      private var _what:String;
      [Bindable]
      private var _id:String;

      [Bindable]
      private var types:ArrayCollection = new ArrayCollection(['metadata', 'full', 'operation', 'target']);
      
      public function set job(j:BackupJob):void
      {
        _job = j;
        _what = _job.what.split(':')[0];
        _id = _job.what.split(':')[1];
      }
      
      private function saveMe():void
      {
        _job.enabled = formEnabled.selected;
        _job.name = formName.text;
          
        var what:String = formType.selectedItem;
        if (what == 'operation' || what == 'target')
          what += ":" + searchField.selectedItem._id;
        
        _job.what = what;
        
        /* reset the status on save */
        _job.lastrun = 0;
        _job.status = 'QUEUED';
        
        PopUpManager.removePopUp(this);
      }
      
    ]]>
  </fx:Script>
  
  <fx:Metadata>
    [ResourceBundle("localized_main")] 
  </fx:Metadata>
  
  <s:Form left="5" right="5" top="5" bottom="5" skinClass="it.ht.rcs.console.skins.CompactForm" >
    <s:FormItem label="{R.get('ENABLED')}" skinClass="it.ht.rcs.console.skins.CompactFormItem">
      <s:CheckBox id="formEnabled" selected="{_job.enabled}"/>
    </s:FormItem>
    <s:FormItem label="{R.get('WHAT')}" skinClass="it.ht.rcs.console.skins.CompactFormItem">
      <s:HGroup>
        <s:DropDownList id="formType" width="100" dataProvider="{types}" selectedIndex="{types.toArray().indexOf(_what)}"/>
        <items:SearchField id="searchField" right="5" top="0" selectedItemId="{_id}" kinds="{[formType.selectedItem]}" visible="{formType.selectedItem == 'operation' || formType.selectedItem == 'target'}"/>        
      </s:HGroup>
    </s:FormItem>
    <s:FormItem label="{R.get('WHEN')}" skinClass="it.ht.rcs.console.skins.CompactFormItem">
      
    </s:FormItem>
    <s:FormItem label="{R.get('NAME')}" skinClass="it.ht.rcs.console.skins.CompactFormItem">
      <s:TextInput id="formName" text="{_job.name}" width="200" restrict="^ " />
    </s:FormItem>
    
  </s:Form>
</utils:TitleWindowSaveClose>
