<?xml version="1.0" encoding="utf-8"?>
<s:HGroup xmlns:fx="http://ns.adobe.com/mxml/2009" 
          xmlns:s="library://ns.adobe.com/flex/spark" 
          xmlns:mx="library://ns.adobe.com/flex/mx"
          horizontalAlign="right">
    <fx:Script>
      <![CDATA[
        import it.ht.rcs.console.agent.model.Agent;
        import it.ht.rcs.console.monitor.controller.LicenseManager;
        import it.ht.rcs.console.operations.view.configuration.ConfigurationView;
        import it.ht.rcs.console.utils.AlertPopUp;
        
        import locale.R;

        public var create:Function;
        
        public var enableDemo:Boolean = true;
        
        [Bindable]
        private var isWindows:Boolean;
        
        private var scout:Boolean
        
        [Bindable]
        public var configView:ConfigurationView;
        
        
        public function set platforms(platforms:Array):void 
        {
          scoutCh.selected=true;
          scout=true;
          isWindows=false;
          // reset the status
          createBtn.enabled = false;
          demo.enabled = false;
          demo.selected = false;
          
          // we need at least build or demo to create an agent
          platforms.forEach(function (element:*, index:int, arr:Array):void {
           if(platforms.length==1 && element=="windows") 
              isWindows=true;
            if (LicenseManager.instance.canBuild(element as String) || LicenseManager.instance.haveDemo(element as String))
              createBtn.enabled = true;
          });

          // none can build
          var build:Boolean = false;
          platforms.forEach(function (element:*, index:int, arr:Array):void {
            if (LicenseManager.instance.canBuild(element as String))
              build = true;
          });
          
          if (!build) {
            demo.selected = true;
          }

          // both demo and build
          var one_build:Boolean = false;
          var one_demo:Boolean = false
          platforms.forEach(function (element:*, index:int, arr:Array):void {
            if (LicenseManager.instance.canBuild(element as String))
              one_build = true;
            if (LicenseManager.instance.haveDemo(element as String))
              one_demo = true;
          });
            
          if (one_build && one_demo) {
            demo.enabled = true;
          }
          
          if (!enableDemo) {
            demo.enabled = false;
            demo.selected = false;       
            scoutCh.enabled = false;
          }
          
        }
        private function onScoutSelection():void
        {
          scout=scoutCh.selected;
        if(scoutCh.selected && demo.selected)
          demo.selected=false;
        }
        
        private function onDemoSelection():void
        {
          if(demo.selected)
            scoutCh.selected=false;
          if(!demo.selected)
            scoutCh.selected=scout;
        }
        
        private function checkConfigurationMode():void
        {
          scout=scoutCh.selected;
          if(scout && configView.currentState=="advanced" && isWindows)
          {
            AlertPopUp.show(R.get('CONFIG_SCOUT_ADVANCED_WARNING'));
          }
            else
          {
            create();
          }
           
        }
        
      ]]>
    </fx:Script>
   <!-- <s:Label id="platformTxt" text="windows" visible="{isWindows}"/>-->
    <s:CheckBox id="scoutCh" left="10" label="{R.get('SCOUT')}" fontWeight="bold" visible="{!LicenseManager.instance.scout &amp;&amp; isWindows}" enabled="{!LicenseManager.instance.scout &amp;&amp; isWindows}" selected="true" change="onScoutSelection()"/>
    <s:Spacer width="100%"/>
    <s:CheckBox id="demo" left="10" label="{R.get('DEMO_MODE')}" fontWeight="bold" change="onDemoSelection()"/>
    <s:Button id="createBtn" right="10" label="{R.get('CREATE')}..." click="checkConfigurationMode()" />    
  
</s:HGroup>
