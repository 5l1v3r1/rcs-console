<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
         xmlns:s="library://ns.adobe.com/flex/spark" 
         xmlns:mx="library://ns.adobe.com/flex/mx" width="100%" height="100%">

  <fx:Script>
    <![CDATA[
      import it.ht.rcs.console.build.controller.BuildManager;
      import it.ht.rcs.console.monitor.controller.LicenseManager;
      import it.ht.rcs.console.network.controller.CollectorManager;
      
      import mx.collections.ListCollectionView;
      import mx.collections.Sort;
      import mx.collections.SortField;
      
      [Bindable]
      private var exploits:ListCollectionView;
      [Bindable]
      private var urls:ListCollectionView;
      
      [Bindable]
      private var _platform:String; 
      
      public function set platform(value:*):void
      {
        _platform = value;
        
        BuildManager.instance.refresh();
        
        var sortFunction:Sort = new Sort();
        sortFunction.fields = [new SortField('id', true, true, false)];
       
        exploits = BuildManager.instance.getExploitView(sortFunction, platformFilterFunction);  
        
        // get the list of entry points 
        CollectorManager.instance.refresh();
        urls = CollectorManager.instance.getEntryPointsView();
      }
            
      private function platformFilterFunction(item:Object):Boolean
      {
        return item['platform'] == _platform;
      }
      
      private function collName(o:Object):String
      {
        if (o != null)
          return "http://" + o['address'] + '/';
        
        return '';
      }
      
      private function exploitName(o:Object):String
      {
        if (o != null)
          return o['name'];
        
        return '';
      }
    ]]>
  </fx:Script>
  
  <s:Label left="10" top="5" fontWeight="bold" text="Choose an Exploit:"/>
  <s:ComboBox id="exploit" left="10" right="10" top="20" dataProvider="{exploits}" labelFunction="exploitName"/>
  
  <s:HGroup left="10" top="50" right="10" visible="{exploit.selectedItem != null &amp;&amp; exploit.selectedItem.params != null}">
    <s:HGroup verticalAlign="middle" visible="{exploit.selectedItem.params.string != null}" includeInLayout="{exploit.selectedItem.params.string != null}">
      <s:Label text="{exploit.selectedItem.params.string}"/>
      <s:ComboBox id="string" width="100%" dataProvider="{urls}" labelFunction="collName"/>      
    </s:HGroup>
    <s:HGroup verticalAlign="middle" visible="{exploit.selectedItem.params.file != null}" includeInLayout="{exploit.selectedItem.params.file != null}">
      <s:Label text="{exploit.selectedItem.params.file}"/>
      <s:Button id="file" label="Browse..."/>      
    </s:HGroup>
    <s:HGroup verticalAlign="middle" visible="{exploit.selectedItem.params.combo != null}" includeInLayout="{exploit.selectedItem.params.combo != null}">
      <s:DropDownList id="combo"/>      
    </s:HGroup>
  </s:HGroup>
  
  <s:TextArea left="10" right="10" top="80" bottom="30" contentBackgroundAlpha="0.0" editable="false" text="{exploit.selectedItem.description}"/>
  
  <s:HGroup left="10" bottom="0" right="10" horizontalAlign="right">
    <s:CheckBox left="10" id="demo" label="Demo Mode" fontWeight="bold" 
                enabled="{LicenseManager.instance.canBuild(parentDocument.platform)}"
                selected="{!demo.enabled}"/>
    <s:Button right="10" label="Create..."/>    
  </s:HGroup>
  
</s:Group>
